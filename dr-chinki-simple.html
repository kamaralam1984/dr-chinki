<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Chinki - Complete AI Medical & Business Oracle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --accent: #38bdf8;
            --bg-medical: #020617;
            --glass-bg: rgba(15, 23, 42, 0.8);
            --glass-border: rgba(56, 189, 248, 0.2);
        }

        html,
        body,
        #root {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--bg-medical);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: #f1f5f9;
            background-image:
                radial-gradient(at 0% 0%, hsla(222, 47%, 11%, 1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(199, 89%, 15%, 1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(222, 47%, 11%, 1) 0, transparent 50%);
        }

        .cyber-glass {
            background: var(--glass-bg);
            backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
        }

        .glow-text {
            text-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }

        .glow-cyan {
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
        }

        .scanline {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(56, 189, 248, 0.05) 50%, transparent);
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            animation: scan 10s linear infinite;
            z-index: 50;
        }

        @keyframes scan {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100%);
            }
        }

        .medical-grid {
            background-size: 50px 50px;
            background-image: radial-gradient(circle, rgba(56, 189, 248, 0.07) 1px, transparent 1px);
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(56, 189, 248, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(56, 189, 248, 0.5);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .shadow-glow {
            box-shadow: 0 0 10px currentColor;
        }
    </style>
</head>

<body class="medical-grid">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback, useRef, useEffect } = React;

        // ============ CONFIGURATION ============
        const API_KEY = 'VITE_API_KEY=AIzaSyBtHPQuD-qsGwzfWX3-tQ2PVEIygrlMl7E';

        const INITIAL_GREETING = `üåü **Namaste Boss Jaan!** üåü

Main hoon **Dr. Chinki** - aapki personal AI Medical Tutor aur Oracle! 

‚ú® **Main kya kar sakti hoon:**
- ü©∫ Medical diagnosis aur treatment advice
- üß† 3D organ visualization
- üìπ YouTube video analysis
- üåê Website analysis
- üë§ Face reading & personality analysis
- üîÆ Paranormal & spiritual guidance
- üìÑ Document processing
- üíº Business growth analysis
- üé• Live video consultation
- üé§ Voice interaction

**Aap mujhse kuch bhi pooch sakte hain Boss Jaan!** Medical, business, ya koi bhi sawal - main yahin hoon! üíï`;

        // ============ GEMINI SERVICE (Mock for demo) ============
        const getTutorResponse = async (prompt, history = [], files = null) => {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 1500));

            return {
                explanation: `Boss Jaan, maine aapka sawal samjha: "${prompt}"\n\nMain aapki madad karne ke liye yahin hoon! Aap mujhse medical advice, business analysis, ya koi bhi guidance le sakte hain. üíï\n\n**Note:** Ye demo version hai. Full functionality ke liye API key configure karein.`,
                voiceOutput: `Boss Jaan, main aapki madad karne ke liye yahin hoon!`,
                suggestedModel: 'heart',
                imagePrompt: '',
                groundingLinks: []
            };
        };

        // ============ CHAT PANE COMPONENT ============
        const ChatPane = ({ messages, onSendMessage, isThinking }) => {
            const [input, setInput] = useState('');
            const [files, setFiles] = useState([]);
            const [isRecording, setIsRecording] = useState(false);
            const messagesEndRef = useRef(null);
            const mediaRecorderRef = useRef(null);
            const audioChunksRef = useRef([]);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const handleSend = () => {
                if (input.trim() || files.length > 0) {
                    onSendMessage(input, files);
                    setInput('');
                    setFiles([]);
                }
            };

            const handleFileUpload = async (e) => {
                const uploadedFiles = Array.from(e.target.files);
                const filePromises = uploadedFiles.map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            resolve({
                                data: event.target.result.split(',')[1],
                                mimeType: file.type
                            });
                        };
                        reader.readAsDataURL(file);
                    });
                });
                const processedFiles = await Promise.all(filePromises);
                setFiles(processedFiles);
            };

            const startRecording = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorderRef.current = new MediaRecorder(stream);
                    audioChunksRef.current = [];

                    mediaRecorderRef.current.ondataavailable = (event) => {
                        audioChunksRef.current.push(event.data);
                    };

                    mediaRecorderRef.current.onstop = async () => {
                        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });
                        const reader = new FileReader();
                        reader.onload = () => {
                            const base64 = reader.result.split(',')[1];
                            onSendMessage('Voice message recorded', [], base64);
                        };
                        reader.readAsDataURL(audioBlob);
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorderRef.current.start();
                    setIsRecording(true);
                } catch (error) {
                    console.error('Recording error:', error);
                    alert('Microphone access denied or not available');
                }
            };

            const stopRecording = () => {
                if (mediaRecorderRef.current && isRecording) {
                    mediaRecorderRef.current.stop();
                    setIsRecording(false);
                }
            };

            return (
                <div className="flex flex-col h-full cyber-glass bg-slate-900/40 rounded-[2.5rem] border-slate-800 overflow-hidden">
                    <div className="flex-1 overflow-y-auto p-4 md:p-6 space-y-4">
                        {messages.map(msg => (
                            <div key={msg.id} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] p-4 rounded-2xl ${msg.role === 'user' ? 'bg-sky-500/20 text-sky-100' : 'bg-slate-800/50 text-slate-100'}`}>
                                    <div className="text-sm whitespace-pre-wrap" dangerouslySetInnerHTML={{
                                        __html: msg.content
                                            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                            .replace(/\n/g, '<br/>')
                                    }} />
                                </div>
                            </div>
                        ))}
                        {isThinking && (
                            <div className="flex justify-start">
                                <div className="bg-slate-800/50 p-4 rounded-2xl">
                                    <div className="flex gap-2">
                                        <div className="w-2 h-2 bg-sky-400 rounded-full animate-pulse"></div>
                                        <div className="w-2 h-2 bg-sky-400 rounded-full animate-pulse" style={{ animationDelay: '0.2s' }}></div>
                                        <div className="w-2 h-2 bg-sky-400 rounded-full animate-pulse" style={{ animationDelay: '0.4s' }}></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>
                    <div className="p-4 border-t border-slate-800">
                        <div className="flex gap-2">
                            <input
                                type="file"
                                multiple
                                onChange={handleFileUpload}
                                className="hidden"
                                id="file-upload"
                                accept="image/*,video/*,audio/*,.pdf,.doc,.docx"
                            />
                            <label
                                htmlFor="file-upload"
                                className="cyber-glass p-3 rounded-xl cursor-pointer hover:bg-slate-800/50 transition-all"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5 text-sky-400">
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13" />
                                </svg>
                            </label>
                            <button
                                onClick={isRecording ? stopRecording : startRecording}
                                className={`cyber-glass p-3 rounded-xl transition-all ${isRecording ? 'bg-red-500/20 text-red-400 animate-pulse' : 'hover:bg-slate-800/50 text-sky-400'}`}
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" />
                                </svg>
                            </button>
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                                placeholder="Boss Jaan, kuch poochiye..."
                                className="flex-1 cyber-glass bg-slate-900/40 text-white px-4 py-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-sky-500/50"
                            />
                            <button
                                onClick={handleSend}
                                disabled={isThinking}
                                className="cyber-glass bg-sky-500/20 text-sky-400 px-6 py-3 rounded-xl font-bold hover:bg-sky-500/30 transition-all disabled:opacity-50"
                            >
                                Send
                            </button>
                        </div>
                        {files.length > 0 && (
                            <div className="mt-2 text-xs text-sky-400">
                                {files.length} file(s) attached
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ============ VISUAL PANE COMPONENT ============
        const VisualPane = ({ model, generatedImageUrl, isImageEnabled }) => {
            const organInfo = {
                heart: { name: 'Heart ‚ù§Ô∏è', color: '#ef4444', description: 'Pumps blood throughout the body', emoji: '‚ù§Ô∏è' },
                brain: { name: 'Brain üß†', color: '#8b5cf6', description: 'Controls all body functions', emoji: 'üß†' },
                lungs: { name: 'Lungs ü´Å', color: '#06b6d4', description: 'Responsible for breathing', emoji: 'ü´Å' },
                liver: { name: 'Liver', color: '#f59e0b', description: 'Detoxifies blood', emoji: 'ü´Ä' },
                kidney: { name: 'Kidney', color: '#10b981', description: 'Filters waste from blood', emoji: 'ü´ò' },
                stomach: { name: 'Stomach', color: '#ec4899', description: 'Digests food', emoji: 'ü´É' },
                none: null
            };

            const currentOrgan = organInfo[model];

            return (
                <div className="w-full h-full flex flex-col items-center justify-center p-8 cyber-glass bg-slate-900/40 rounded-[2.5rem] border-slate-800">
                    {generatedImageUrl && isImageEnabled ? (
                        <div className="w-full h-full flex items-center justify-center">
                            <img
                                src={generatedImageUrl}
                                alt="Generated Medical Image"
                                className="max-w-full max-h-full object-contain rounded-2xl"
                            />
                        </div>
                    ) : currentOrgan ? (
                        <div className="text-center">
                            <div
                                className="w-48 h-48 rounded-full mx-auto mb-6 flex items-center justify-center"
                                style={{
                                    background: `radial-gradient(circle, ${currentOrgan.color}40, transparent)`,
                                    boxShadow: `0 0 60px ${currentOrgan.color}60`
                                }}
                            >
                                <div
                                    className="text-8xl"
                                    style={{ filter: `drop-shadow(0 0 20px ${currentOrgan.color})` }}
                                >
                                    {currentOrgan.emoji}
                                </div>
                            </div>
                            <h2 className="text-3xl font-bold text-white mb-2">{currentOrgan.name}</h2>
                            <p className="text-slate-400">{currentOrgan.description}</p>
                        </div>
                    ) : (
                        <div className="text-center">
                            <div className="w-32 h-32 mx-auto mb-6 rounded-full bg-sky-500/10 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-16 h-16 text-sky-400/50">
                                    <path strokeLinecap="round" strokeLinejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232 1.232 3.233 0 4.465l-1.7 1.7c-.232.232-.535.352-.85.352H15.4c-.316 0-.62-.12-.85-.352l-2.085-2.085a2.25 2.25 0 00-3.182 0l-2.085 2.085a1.2 1.2 0 01-.85.352H3.4a1.2 1.2 0 01-.85-.352l-1.7-1.7a3.182 3.182 0 010-4.465L2.252 15.3M9 11.25v1.5M12 9v3.75m3-6v6" />
                                </svg>
                            </div>
                            <h3 className="text-slate-400 font-black text-xs uppercase tracking-widest">3D Visual Lab</h3>
                            <p className="text-[10px] text-slate-600 mt-2 italic">Waiting for visualization request...</p>
                        </div>
                    )}
                </div>
            );
        };

        // ============ LIVE TUTOR COMPONENT ============
        const LiveTutor = ({ isActive, onClose }) => {
            const [isVideoActive, setIsVideoActive] = useState(false);
            const videoRef = useRef(null);
            const streamRef = useRef(null);

            const startVideo = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                        streamRef.current = stream;
                        setIsVideoActive(true);
                    }
                } catch (error) {
                    console.error('Camera access error:', error);
                    alert('Camera access denied or not available');
                }
            };

            const stopVideo = () => {
                if (streamRef.current) {
                    streamRef.current.getTracks().forEach(track => track.stop());
                    setIsVideoActive(false);
                }
            };

            const handleClose = () => {
                stopVideo();
                onClose();
            };

            if (!isActive) return null;

            return (
                <div
                    className="fixed inset-0 z-50 flex items-center justify-center p-4"
                    style={{ background: 'rgba(0, 0, 0, 0.9)' }}
                >
                    <div className="cyber-glass rounded-3xl p-6 max-w-4xl w-full">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold text-sky-400">üé• Live Consultation</h2>
                            <button
                                onClick={handleClose}
                                className="text-slate-400 hover:text-white transition-colors text-2xl w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-800"
                            >
                                ‚úï
                            </button>
                        </div>
                        <div className="aspect-video bg-slate-900 rounded-2xl overflow-hidden mb-4">
                            <video
                                ref={videoRef}
                                autoPlay
                                playsInline
                                muted
                                className="w-full h-full object-cover"
                            />
                        </div>
                        <div className="flex gap-4 justify-center">
                            {!isVideoActive ? (
                                <button
                                    onClick={startVideo}
                                    className="cyber-glass bg-sky-500/20 text-sky-400 px-6 py-3 rounded-xl font-bold hover:bg-sky-500/30 transition-all"
                                >
                                    üìπ Start Camera
                                </button>
                            ) : (
                                <button
                                    onClick={stopVideo}
                                    className="cyber-glass bg-red-500/20 text-red-400 px-6 py-3 rounded-xl font-bold hover:bg-red-500/30 transition-all"
                                >
                                    ‚èπÔ∏è Stop Camera
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ MAIN APP COMPONENT ============
        const App = () => {
            const [messages, setMessages] = useState([
                { id: '1', role: 'assistant', content: INITIAL_GREETING, timestamp: Date.now() }
            ]);
            const [currentModel, setCurrentModel] = useState('none');
            const [generatedImageUrl, setGeneratedImageUrl] = useState(null);
            const [isThinking, setIsThinking] = useState(false);
            const [isLiveActive, setIsLiveActive] = useState(false);
            const [isVoiceEnabled, setIsVoiceEnabled] = useState(true);
            const [isImageEnabled, setIsImageEnabled] = useState(true);

            const synthRef = useRef(window.speechSynthesis);

            const handleSendMessage = useCallback(async (text, files = [], audioBase64 = null) => {
                const finalPrompt = text || 'Voice message';

                const userMsg = {
                    id: Date.now().toString(),
                    role: 'user',
                    content: finalPrompt,
                    timestamp: Date.now()
                };

                setMessages(prev => [...prev, userMsg]);
                setIsThinking(true);

                try {
                    const history = messages.slice(-5).map(m => ({ role: m.role, content: m.content }));
                    const response = await getTutorResponse(finalPrompt, history, files);

                    if (!response) {
                        setMessages(prev => [...prev, {
                            id: Date.now().toString(),
                            role: 'assistant',
                            content: 'Maafi chahti hoon Boss Jaan, system me thodi thakaan hai. Ek baar phir puchiye na!',
                            timestamp: Date.now()
                        }]);
                        return;
                    }

                    const botMsg = {
                        id: (Date.now() + 1).toString(),
                        role: 'assistant',
                        content: response.explanation,
                        timestamp: Date.now()
                    };

                    setMessages(prev => [...prev, botMsg]);

                    if (response.suggestedModel && response.suggestedModel !== 'none') {
                        setCurrentModel(response.suggestedModel);
                    }

                    if (response.voiceOutput && isVoiceEnabled) {
                        synthRef.current.cancel();
                        const utterance = new SpeechSynthesisUtterance(response.voiceOutput);
                        utterance.lang = 'hi-IN';
                        utterance.rate = 1.0;
                        synthRef.current.speak(utterance);
                    }
                } catch (err) {
                    console.error(err);
                    setMessages(prev => [...prev, {
                        id: Date.now().toString(),
                        role: 'assistant',
                        content: 'Kuch gadbad ho gayi Boss Jaan, lekin main yahin hoon. Dubara koshish karein?',
                        timestamp: Date.now()
                    }]);
                } finally {
                    setIsThinking(false);
                }
            }, [messages, isVoiceEnabled]);

            return (
                <div className="h-screen w-full flex flex-col p-3 md:p-6 overflow-hidden bg-slate-900 font-sans">
                    <div className="scanline"></div>

                    <div className="flex justify-between items-center mb-4 md:mb-6 z-10">
                        <div className="flex items-center gap-3 md:gap-5">
                            <div className="w-10 h-10 md:w-16 md:h-16 cyber-glass rounded-xl md:rounded-2xl overflow-hidden flex items-center justify-center border-sky-500/30 glow-cyan">
                                <img
                                    src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&q=80&w=200&h=200"
                                    alt="Dr. Chinki"
                                    className="w-full h-full object-cover"
                                />
                            </div>
                            <div>
                                <h1 className="font-extrabold text-lg md:text-3xl text-white tracking-tight glow-text uppercase leading-none">
                                    DR. <span className="text-sky-400">CHINKI</span>
                                </h1>
                                <p className="text-[8px] md:text-[10px] text-sky-400/60 font-bold uppercase tracking-[0.2em] mt-1">
                                    World's Best Doctor & Oracle
                                </p>
                            </div>
                        </div>

                        <div className="flex items-center gap-2 md:gap-4">
                            <button
                                onClick={() => setIsImageEnabled(!isImageEnabled)}
                                className={`hidden md:flex items-center gap-2 cyber-glass px-3 py-2 rounded-xl font-black text-[9px] transition-all uppercase tracking-[0.2em] ${isImageEnabled ? 'bg-purple-500/20 text-purple-400 border-purple-500/30' : 'bg-slate-800 text-slate-400 border-slate-700'}`}
                            >
                                IMAGING {isImageEnabled ? 'ON' : 'OFF'}
                            </button>
                            <button
                                onClick={() => setIsVoiceEnabled(!isVoiceEnabled)}
                                className={`flex items-center gap-2 cyber-glass px-3 py-2 rounded-xl font-black text-[9px] transition-all uppercase tracking-[0.2em] ${isVoiceEnabled ? 'bg-sky-500/20 text-sky-400 border-sky-500/30' : 'bg-slate-800 text-slate-400 border-slate-700'}`}
                            >
                                VOICE {isVoiceEnabled ? 'ON' : 'OFF'}
                            </button>
                            <button
                                onClick={() => setIsLiveActive(true)}
                                className="flex items-center gap-2 md:gap-3 cyber-glass bg-sky-500/10 text-sky-400 px-3 py-2 md:px-6 md:py-3 rounded-xl md:rounded-2xl font-black text-[9px] md:text-[10px] hover:bg-sky-500/20 transition-all border-sky-500/30 uppercase tracking-[0.2em]"
                            >
                                <div className="w-1.5 h-1.5 md:w-2 md:h-2 bg-sky-400 rounded-full shadow-glow animate-pulse"></div>
                                LIVE
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 flex flex-col md:flex-row gap-4 md:gap-6 min-h-0 z-10 relative">
                        <div className="flex-1 md:flex-none md:w-[40%] flex flex-col min-h-0">
                            <ChatPane
                                messages={messages}
                                onSendMessage={handleSendMessage}
                                isThinking={isThinking}
                            />
                        </div>
                        <div className="flex-1 flex flex-col min-h-0">
                            <VisualPane
                                model={currentModel}
                                generatedImageUrl={generatedImageUrl}
                                isImageEnabled={isImageEnabled}
                            />
                        </div>
                    </div>

                    {isLiveActive && (
                        <LiveTutor
                            isActive={isLiveActive}
                            onClose={() => setIsLiveActive(false)}
                        />
                    )}
                </div>
            );
        };

        // ============ RENDER APP ============
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>